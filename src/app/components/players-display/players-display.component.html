<p-table *ngIf="!playerInputVisible" #playersTable [columns]="playerProperties" [value]="players" [(selection)]="selectedPlayers" [rowHover]="true" selectionMode="multiple" [globalFilterFields]="['name']" styleClass="p-datatable-sm p-datatable-striped p-datatable-gridlines"
    (selectionChange)="selectionChanged()">
    <ng-template pTemplate="caption">
        <div class="flex align-items-center">
            <span>{{title}}</span>
            <div *ngIf="isAllPlayersTable" class="p-inputgroup w-auto ml-auto">
                <span class="p-inputgroup-addon">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </span>
                <input #tableFilter pInputText type="text" (input)="filterPlayers(playersTable, $event.target)" placeholder="Search keyword"/>
                <button type="button" pButton icon="fa-solid fa-xmark" (click)="clearFilter(playersTable, tableFilter)"></button>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="header" let-properties>
        <tr>
            <th *ngIf="isAllPlayersTable">
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th class="text-center">#</th>
            <th *ngFor="let prop of properties" [pSortableColumn]="prop" class="text-center">
                {{ prop | titlecase }} <p-sortIcon [field]="prop"></p-sortIcon>
            </th>
            <!-- <th *ngIf="isAllPlayersTable" class="p-0">
                <button pButton pRipple type="button" pTooltip="Add Player" icon="fa-solid fa-plus" (click)="showPlayerInputDialog(null)" class=" p-button-sm"></button>
            </th> -->
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-player let-rowIndex="rowIndex" let-properties="columns">
        <tr>
            <td *ngIf="isAllPlayersTable">
                <p-tableCheckbox [value]="player"></p-tableCheckbox>
            </td>
            <td>{{ rowIndex + 1 }}</td>
            <ng-container *ngFor="let prop of properties; let i = index">
                <!-- player properties start with name(0), gender(1), and skills(2,...,n) one by one -->
                <ng-container [ngSwitch]="i">
                    <ng-container *ngSwitchCase="0">
                        <ng-container *ngTemplateOutlet="namePropTemplate; context:{$implicit: player | playerSkillValue : prop}">
                        </ng-container>
                    </ng-container>
                    <ng-container *ngSwitchCase="1">
                        <ng-container *ngTemplateOutlet="genderPropTemplate; context:{$implicit: player | playerSkillValue : prop}">
                        </ng-container>
                    </ng-container>
                    <ng-container *ngSwitchDefault>
                        <ng-container *ngTemplateOutlet="skillPropTemplate; context:{$implicit: player | playerSkillValue : prop}">
                        </ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
            <!-- <td *ngIf="isAllPlayersTable" class="p-0">
                <button pButton pRipple type="button" pTooltip="Edit Player" icon="fa-solid fa-pen" (click)="showPlayerInputDialog(player)" class="p-button-text p-button-sm"></button>
            </td> -->
        </tr>
    </ng-template>
</p-table>

<ng-template #namePropTemplate let-value>
    <td>
        {{ value }}
    </td>
</ng-template>

<ng-template #genderPropTemplate let-value>
    <td class="text-center">
        <i class="fa-solid" [ngClass]="value === 0 ? 'fa-mars' : 'fa-venus'" [ngStyle]="{'color': value === 0 ? 'deepskyblue' : 'deeppink'}"></i>
    </td>
</ng-template>

<ng-template #skillPropTemplate let-value>
    <td class="text-center" [ngStyle]="{'background-color': value > 8 ? '#3ab449' : value > 6 ? '#92ca61' : value > 3 ? '#fcb041' : value > 1 ? '#f57951' : '#e22026'}">
        {{ value | number: '1.0-2' }}
    </td>
</ng-template>

<p-dialog [header]="selectedPlayer ? 'Edit Player' : 'Add Player'" [(visible)]="playerInputVisible" [modal]="true" [draggable]="false" [resizable]="false">
    <app-player-input *ngIf="playerInputVisible" [selectedPlayer]="selectedPlayer" (playerUpdated)="playerUpdated($event)"></app-player-input>
</p-dialog>